rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if user is admin
    function isAdmin() {
      return request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "admin";
    }

    // Pages collection: Public read, Admin write
    match /pages/{pageId} {
      allow read: if true;
      allow write: if isAdmin(); // Only admins can edit content
    }

    // Settings collection: Public read, Admin write
    match /settings/{settingId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Users collection: User can read own profile, Admin can read/write all (optional)
    // For this app, we mainly need to read the user's role.
    // Allow a user to read their own document to check role
    match /users/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if false; // Admins are created manually
    }
    // Messages (Contact Form): Public create, Admin read/write
    match /messages/{messageId} {
      allow create: if true; // Anyone can send a message
      allow read, update, delete: if isAdmin(); // Only admins can view/manage
    }

  }
}
